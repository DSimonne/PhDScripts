did 100 keep 10 run

did mask

applied filter

running 50 keep 5

````bash
(devel.p9) p9-07:50_Ar/S1404/pynxraw % python pynx-cdi-analysis.py S1404_pynx_norm_128_300_294_1_1_1-* modes = 1
****************************************************************************
* hwloc 2.1.0 received invalid information from the operating system.
*
* Group0 (cpuset 0x0000000f,0xffffffff,0xfffffff0) intersects with Package (P#0 cpuset 0xffffffff,0xfffffff0 nodeset 0x00000001) without inclusion!
* Error occurred in topology.c line 1443
*
* The following FAQ entry in the hwloc documentation may help:
*   What should I do when hwloc reports "operating system" warnings?
* Otherwise please report this error message to the hwloc user's mailing list,
* along with the files generated by the hwloc-gather-topology script.
* 
* hwloc will now ignore this invalid topology information and continue.
****************************************************************************
--------------------------------------------------------------------------
No OpenFabrics connection schemes reported that they were able to be
used on a specific port.  As such, the openib BTL (OpenFabrics
support) will be disabled for this port.

  Local host:           p9-07
  Local device:         mlx5_0
  Local port:           1
  CPCs attempted:       udcm
--------------------------------------------------------------------------
Importing data files
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T15-55-46_Run0008_LLKf000.1517_LLK5229768753.0518_SupportThreshold0.13351.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T16-00-03_Run0014_LLKf000.1492_LLK5000025629.9973_SupportThreshold0.13282.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T16-03-37_Run0019_LLKf000.1540_LLK5083829164.5050_SupportThreshold0.12375.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T16-05-56_Run0022_LLKf000.1709_LLK5178054571.1517_SupportThreshold0.11183.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T16-25-13_Run0044_LLKf000.1566_LLK5247429013.2523_SupportThreshold0.13454.cxi
Calculating modes from the imported objects
Matching arrays against the first one [S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T16-00-03_Run0014_LLKf000.1492_LLK5000025629.9973_SupportThreshold0.13282.cxi] - this may take a while
R_match(0, 1) = 72.605% [3 arrays remaining]
R_match(0, 2) = 75.313% [2 arrays remaining]
R_match(0, 3) = 71.206% [1 arrays remaining]
R_match(0, 4) = 69.945% [0 arrays remaining]
Elapsed time:   36.1s
Analysing modes
First mode represents 77.865%
Saving modes analysis to: modes.h5
````

### Do it again with better mask

````bash
(pynx-gap.p9) p9-07:50_Ar/S1404/pynxraw % python pynx-id01cdi.py pynx-cdi-input_50.txt
/data/id01/inhouse/richard/pynx-gap.p9/lib/python3.8/site-packages/skcuda/cublas.py:284: UserWarning: creating CUBLAS context to get version number
  warnings.warn('creating CUBLAS context to get version number')
Using parameters file:  pynx-cdi-input_50.txt
data S1404_pynx_norm_128_300_294_1_1_1.npz
mask S1404_maskpynx_norm_128_300_294_1_1_1.npz
data2cxi True
auto_center_resize False
support filter_sig5_t20_mask_0.2.npz
support_threshold 0.1,0.2
support_only_shrink False
support_update_period 20
support_smooth_width_begin 2
support_smooth_width_end 1
support_post_expand 1,-2,1
mask_interp 8,2
confidence_interval_factor_mask 0.5,1.2
psf True
nb_raar 1000
nb_hio 400
nb_er 300
nb_ml 0
nb_run 50
nb_run_keep 5
zero_mask False
crop_output 0
positivity False
beta 0.9
detwin False
rebin 1,1,1
detector_distance 0.84
pixel_size_detector 55e-6
wavelength 1.3775e-10
verbose 100
output_format cxi
live_plot False

Loading data:  S1404_pynx_norm_128_300_294_1_1_1.npz
Finished loading iobs data, with size: 11289600
Data CXI file already exists, not overwriting:  S1404_pynx_norm_128_300_294_1_1_1.cxi
CDI runner: preparing processing unit
Computing FFT speed for available CUDA GPU[ranking by fft, fft_shape=(16, 400, 400)]:
                                        Tesla V100-SXM2-32GB: 32256Mb ,1549.67 Gflop/s
                                        Tesla V100-SXM2-32GB: 32256Mb ,1536.73 Gflop/s
Using CUDA GPU: Tesla V100-SXM2-32GB
Loading mask from:  S1404_maskpynx_norm_128_300_294_1_1_1.npz
Initialized mask, with 887852 pixels masked ( 7.864%)
Rebinning Iobs with rebin=(1,1,1)
Ignoring rebin=1
Loading support from:  filter_sig5_t20_mask_0.2.npz
Initialized support  (128, 300, 294) , with 91966 pixels ( 0.815%)
Centering & reshaping data: (128, 300, 294) -> (128, 300, 294)
````

````bash
(devel.p9) p9-07:50_Ar/S1404/pynxraw % python pynx-cdi-analysis.py S1404_pynx_norm_128_300_294_1_1_1-* modes=1
****************************************************************************
* hwloc 2.1.0 received invalid information from the operating system.
*
* Group0 (cpuset 0x0000000f,0xffffffff,0xfffffff0) intersects with Package (P#0 cpuset 0xffffffff,0xfffffff0 nodeset 0x00000001) without inclusion!
* Error occurred in topology.c line 1443
*
* The following FAQ entry in the hwloc documentation may help:
*   What should I do when hwloc reports "operating system" warnings?
* Otherwise please report this error message to the hwloc user's mailing list,
* along with the files generated by the hwloc-gather-topology script.
* 
* hwloc will now ignore this invalid topology information and continue.
****************************************************************************
--------------------------------------------------------------------------
No OpenFabrics connection schemes reported that they were able to be
used on a specific port.  As such, the openib BTL (OpenFabrics
support) will be disabled for this port.

  Local host:           p9-07
  Local device:         mlx5_0
  Local port:           1
  CPCs attempted:       udcm
--------------------------------------------------------------------------
Importing data files
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T23-13-46_Run0006_LLKf000.1773_LLK5120533704.7577_SupportThreshold0.13071.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T23-30-17_Run0028_LLKf000.1634_LLK6382460594.1772_SupportThreshold0.14350.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T23-31-23_Run0030_LLKf000.1704_LLK5194931030.2734_SupportThreshold0.13185.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T23-32-02_Run0031_LLKf000.1647_LLK5284901261.3297_SupportThreshold0.13527.cxi
Loading: S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T23-42-13_Run0048_LLKf000.1612_LLK5332636833.1909_SupportThreshold0.13741.cxi
Calculating modes from the imported objects
Matching arrays against the first one [S1404_pynx_norm_128_300_294_1_1_1-2020-12-22T23-42-13_Run0048_LLKf000.1612_LLK5332636833.1909_SupportThreshold0.13741.cxi] - this may take a while
R_match(0, 1) = 61.362% [3 arrays remaining]
R_match(0, 2) = 73.732% [2 arrays remaining]
R_match(0, 3) = 62.221% [1 arrays remaining]
R_match(0, 4) = 61.745% [0 arrays remaining]
Elapsed time:   58.1s
Analysing modes
First mode represents 82.327%
Saving modes analysis to: modes.h5
````

# On a une erreur

````bash
(linux.bcdi) david@ord00003:~/Documents/PhD/PhDScripts/Pt_p2/50_Ar/S1404/pynxraw$ python strain_old.py 
/home/david/Documents/PhD/PhDScripts/Pt_p2/50_Ar/S1404/pynxraw/modes.h5
Initial data size: ( 128 , 300 , 294 )
FFT size before accounting for binning (128, 300, 294)
Binning used during phasing: (1, 1, 1)
Padding back to original FFT size (128, 300, 294)
Data shape used for orthogonalization and plotting: ( 182 , 188 , 192 )

Averaging using 1 candidate reconstructions

Opening  /home/david/Documents/PhD/PhDScripts/Pt_p2/50_Ar/S1404/pynxraw/modes.h5
This reconstruction will serve as reference object.

Average performed over  1 reconstructions

Extent of the phase over an extended support (ceil(phase range))~  58 (rad)
Gradient: Phase_ramp_z, Phase_ramp_y, Phase_ramp_x: ( -0.016 0.586 -0.361 ) rad
Max FFT= 1542504.6122274657
Apodization using a 3d Blackman window
Max apodized FFT after normalization = 1542504.6122274657

Shape before orthogonalization (182, 188, 192)
Direct space voxel sizes (z, y, x) based on initial FFT shape: ( 9.25 nm, 11.24 nm, 12.39 nm )
Tilt, pixel_y, pixel_x based on cropped array shape: ( 0.0077 deg, 87.77 um, 84.22 um)
Sanity check, recalculated direct space voxel sizes: ( 9.25  nm, 11.24 nm, 12.39 nm )
using SIXS geometry
rocking angle is mu, with beta non zero
VTK spacing : 5.00 nm
Angle between q and y = 71.79132269042893 deg
Angle with y in zy plane -45.36658787319518 deg
Angle with y in xy plane -70.76682162800394 deg
Angle with z in xz plane 109.46236623829827 deg
Normalized wavevector transfer [z, y, x]: [-0.31650317  0.31247879  0.89564655]
Wavevector transfer: (angstroms) 2.6627
Atomic plane distance: (angstroms) 2.3597 angstroms
center of mass at (z, y, x): ( 87.22 , 94.53 , 96.42 )
center of mass offset: ( 4 , -1 , 0 ) pixels
Gradient: Phase_ramp_z, Phase_ramp_y, Phase_ramp_x: ( 0.001 -0.005 -0.001 ) rad

Aligning Q along  y : [0 1 0]
Rotating back the crystal in laboratory frame
Voxel size:  5.00 nm
Final data shape: 200 200 200
Phase extent before and after thresholding: 10.680021563201016 3.06318850840551
phase.max() =  1.5176890162824492 , at coordinates  96 29 138
Traceback (most recent call last):
  File "/home/david/anaconda3/envs/linux.bcdi/lib/python3.6/site-packages/bcdi-0.0.9-py3.6.egg/bcdi/graph/graph_utils.py", line 208, in combined_plots
TypeError: object of type 'NoneType' has no len()

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "strain_old.py", line 706, in <module>
    tuple_scale='linear', cmap=my_cmap, is_orthogonal=True, reciprocal_space=False)
  File "/home/david/anaconda3/envs/linux.bcdi/lib/python3.6/site-packages/bcdi-0.0.9-py3.6.egg/bcdi/graph/graph_utils.py", line 210, in combined_plots
ValueError: "position" should be a tuple of subplot positions
(linux.bcdi) david@ord00003:~/Documents/PhD/PhDScripts/Pt_p2/50_Ar/S1404/pynxraw$ 
````

# OK POUR STRAIN . py

Il fallait copier du github dans '/home/david/.local/lib/python3.9/site-packages/bcdi/__init__.py'
POurquoi pas dans conda / envs ?

````bash
python strain_old.py 
/home/david/.local/lib/python3.9/site-packages/bcdi/postprocessing/postprocessing_utils.py:50: SyntaxWarning: "is" with a literal. Did you mean "=="?
  if method is 'modulus':
/home/david/.local/lib/python3.9/site-packages/bcdi/postprocessing/postprocessing_utils.py:52: SyntaxWarning: "is" with a literal. Did you mean "=="?
  elif method is 'support':
/home/david/.local/lib/python3.9/site-packages/bcdi/postprocessing/postprocessing_utils.py:229: SyntaxWarning: "is" with a literal. Did you mean "=="?
  if aligning_option is 'com':
/home/david/.local/lib/python3.9/site-packages/bcdi/postprocessing/postprocessing_utils.py:1734: SyntaxWarning: "is" with a literal. Did you mean "=="?
  if sort_method is 'mean_amplitude':    # sort by quality_array[:, 0] first
/home/david/.local/lib/python3.9/site-packages/bcdi/postprocessing/postprocessing_utils.py:1737: SyntaxWarning: "is" with a literal. Did you mean "=="?
  elif sort_method is 'variance':        # sort by quality_array[:, 1] first
/home/david/.local/lib/python3.9/site-packages/bcdi/postprocessing/postprocessing_utils.py:1740: SyntaxWarning: "is" with a literal. Did you mean "=="?
  elif sort_method is 'variance/mean':   # sort by quality_array[:, 2] first
/home/david/.local/lib/python3.9/site-packages/bcdi/postprocessing/postprocessing_utils.py:1743: SyntaxWarning: "is" with a literal. Did you mean "=="?
  elif sort_method is 'volume':          # sort by quality_array[:, 3] first
/home/david/Documents/PhD/PhDScripts/Pt_p2/50_Ar/S1404/pynxraw/modes.h5
Initial data size: ( 128 , 300 , 294 )
FFT size before accounting for binning (128, 300, 294)
Binning used during phasing: (1, 1, 1)
Padding back to original FFT size (128, 300, 294)
Data shape used for orthogonalization and plotting: ( 182 , 188 , 192 )

Averaging using 1 candidate reconstructions

Opening  /home/david/Documents/PhD/PhDScripts/Pt_p2/50_Ar/S1404/pynxraw/modes.h5
This reconstruction will serve as reference object.

Average performed over  1 reconstructions

Extent of the phase over an extended support (ceil(phase range))~  58 (rad)
Gradient: Phase_ramp_z, Phase_ramp_y, Phase_ramp_x: ( -0.016 0.586 -0.361 ) rad
Max FFT= 1542504.6122274657
Apodization using a 3d Blackman window
Max apodized FFT after normalization = 1542504.6122274657

Shape before orthogonalization (182, 188, 192)
Real space pixel size (z, y, x) based on initial FFT shape: ( 6.08 nm, 10.95 nm, 11.18 nm )
Tilt, pixel_y, pixel_x based on actual array shape: ( 0.0077 deg, 87.77 um, 84.22 um)
New real space pixel size (z, y, x) based on actual array shape: ( 6.08  nm, 10.95 nm, 11.18 nm )
using SIXS geometry
rocking angle is mu, with beta non zero
VTK spacing : 5.00 nm
Angle between q and y = 71.79132269042893 deg
Angle with y in zy plane -45.36658787319518 deg
Angle with y in xy plane -70.76682162800394 deg
Angle with z in xz plane 109.46236623829827 deg
Normalized wavevector transfer [z, y, x]: [-0.31650317  0.31247879  0.89564655]
Wavevector transfer: (angstroms) 2.6627
Atomic plane distance: (angstroms) 2.3597 angstroms
center of mass at (z, y, x): ( 87.22 , 94.53 , 96.42 )
center of mass offset: ( 4 , -1 , 0 ) pixels
Gradient: Phase_ramp_z, Phase_ramp_y, Phase_ramp_x: ( 0.001 -0.005 -0.001 ) rad

Aligning Q along  y : [0 1 0]
Rotating back the crystal in laboratory frame
Voxel size:  5.00 nm
Final data shape: 200 200 200
Phase extent before and after thresholding: 10.680021563201015 3.0631885084055095
phase.max() =  1.517689016282449 , at coordinates  96 29 138
End of script
(linux.BCDI_MI) david@ord00003:~/Documents/PhD/PhDScripts/Pt_p2/50_Ar/S1404/pynxraw$ ls
DataAnalysis.ipynb
filter_sig5_t20_mask_0.2.npz
finalmask_S1404_norm_128_300_294_1_1_1.png
finalsum_S1404_norm_128_300_294_1_1_1.png
MakeMask.ipynb
mask_0.2.npz
modes.h5
pynx-cdi-analysis.py
pynx-cdi-input_100.txt
pynx-cdi-input_50.txt
pynx-id01cdi.py
README.md
S1404_ampdispstrain_gap_iso0.2_mode_avg3_apodize_blackman_lab-frame.npz
S1404_amp-disp-strain_gap_iso0.2_mode_avg3_apodize_blackman_lab-frame.vti
S1404_amp_gap_iso0.2_mode_avg3_apodize_blackman_lab-frame.png
S1404_avg_obj_prtf_gap_iso0.2_mode_avg3_apodize_blackman.npz
S1404_bulk_gap_iso0.2_mode_avg3_apodize_blackman_lab-frame.png
S1404_displacement_gap_iso0.2_mode_avg3_apodize_blackman_lab-frame.png
S1404_histo_amp_gap_iso0.2_mode_avg3_apodize_blackman_lab-frame.png
S1404_maskpynx_norm_128_300_294_1_1_1.npz
S1404_pynx_norm_128_300_294_1_1_1.npz
S1404_strain_gap_iso0.2_mode_avg3_apodize_blackman_lab-frame.png
spec-file.txt
strain_old.py
strain.py
````